<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>myTask</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="format-detection" content="telephone=no, address=no, email=no">

<link rel="stylesheet" href="./style.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.5.2/animate.min.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:400,700|Belleza">

<script src="https://cdnjs.cloudflare.com/ajax/libs/vue/2.5.13/vue.js"></script>
</head>
<body>
<div id="wrap">

	<nav>
		<h1>myTask</h1>
		<ul>
			<li v-bind:class="{current: showTemplate === 'taskboard'}"><a href="#" id="nav-tasks" v-on:click.prevent="selectTemplate('taskboard')"><i class="fa fa-pencil-square-o"></i> Tasks</a></li>
			<li v-bind:class="{current: showTemplate === 'receiptboard'}"><a href="#" id="nav-receipts" v-on:click.prevent="selectTemplate('receiptboard')"><i class="fa fa-trophy"></i> Receipts</a></li>
			<li v-bind:class="{current: showTemplate === 'monthlyboard'}"><a href="#" id="nav-monthly" v-on:click.prevent="selectTemplate('monthlyboard')"><i class="fa fa-calendar-check-o"></i> Monthly</a></li>
		</ul>
	</nav>

	<article>
		<taskboard v-if="showTemplate === 'taskboard'"></taskboard>
		<receiptboard v-if="showTemplate === 'receiptboard'"></receiptboard>
		<monthlyboard v-if="showTemplate === 'monthlyboard'"></monthlyboard>

		<footer>Copyright &copy; 2016- <a href="http://www.kiki-verb.com/" target="_blank">kiki-verb.com</a>. All Rights Reserved.</footer>
		<p>{{ name }} は {{ price }}円</p>
	</article>

</div>







<script id="template-tasks" type="text/x-template">
	<section id="section-tasks">
		<header>
			<h2><i class="fa fa-pencil-square-o"></i> Tasks</h2>
			<ul>
				<li><label for="modal"><i class="fa fa-plus-square"></i> 追加</label></li>
			</ul>

			<div class="modal-wrap" id="modal-tasks">
				<input type="checkbox" class="toggle-on" id="modal" v-model="modalEnabled" v-on:click="$parent.focusOn('formtasks')">
				<div class="modal-window">
					<div>
						<form action="" method="post" id="formtasks" class="form-wrap" v-on:submit.prevent="addTask">
							<div>
								<h3>タイトル</h3>
								<input type="text" name="title" value="" required>
							</div>

							<div>
								<h3>クライアント名</h3>
								<input type="text" name="client" value="" required>
							</div>

							<div>
								<h3>内容</h3>
								<textarea name="content" rows="5" cols="5" required></textarea>
							</div>

							<div>
								<input type="hidden" name="date" v-bind:value="$parent.addNowDatetime()" required>
								<input type="hidden" name="category" value="tasks">
								<input type="submit" name="submit" value="送信">
							</div>
						</form>
					</div>

					<label class="toggle-button" for="modal">Close &times;</label>
				</div>
			</div>
		</header>

		<div v-for="task in $parent.tasks" v-if="task.category === 'tasks'">
			<h3>{{ task.title }} | {{ task.category }}</h3>
			<p><span><i class="fa fa-address-book-o"></i> {{ task.client }}</span><span><i class="fa fa-clock-o"></i> {{ task.date }}</span></p>
			<div>{{ task.content }}</div>
			<aside>
				<ul>
					<li><label for="modal"><i class="fa fa-pencil"></i> 編集</label></li>
					<li><a href="#" v-on:click="$parent.changeTask(task.id, 'receipts')"><i class="fa fa-check-square-o"></i> 完了</a></li>
					<li><a href="#" v-on:click="$parent.deleteTask(task.id)"><i class="fa fa-eraser"></i> 削除</a></li>
				</ul>
			</aside>
		</div>

	</section>
</script>

<script id="template-receipts" type="text/x-template">
	<section id="section-receipts">
		<header>
			<h2><i class="fa fa-trophy"></i> Receipts</h2>
		</header>

		<div v-for="task in $parent.tasks" v-if="task.category === 'receipts'">
			<h3>{{ task.title }} | {{ task.category }}</h3>
			<p><span><i class="fa fa-address-book-o"></i> {{ task.client }}</span><span><i class="fa fa-clock-o"></i> {{ task.date }}</span></p>
			<div>{{ task.content }}</div>
			<aside>
				<ul>
					<li><a href="#"><i class="fa fa-pencil"></i> 編集</a></li>
					<li><a href="#" v-on:click="$parent.changeTask(task.id, 'tasks')"><i class="fa fa-share"></i> タスクに戻す</a></li>
<!--					<li><a href="#"><i class="fa fa-check-square-o"></i> 過去ログ化</a></li>-->
					<li><a href="#" v-on:click="$parent.deleteTask(task.id)"><i class="fa fa-eraser"></i> 削除</a></li>
				</ul>
			</aside>
		</div>
	</section>
</script>

<script id="template-monthly" type="text/x-template">
	<section id="section-monthly">
		<header>
			<h2><i class="fa fa-calendar-check-o"></i> Monthly</h2>
			<ul>
				<li><label for="modal"><i class="fa fa-plus-square"></i> 追加</label></li>
			</ul>

			<div class="modal-wrap" id="modal-monthly">
				<input type="checkbox" class="toggle-on" id="modal" v-model="modalEnabled" v-on:click="$parent.focusOn('formmonthly')">
				<div class="modal-window">
					<div>
						<form action="" method="post" id="formmonthly" class="form-wrap" v-on:submit.prevent="addTask">
							<div>
								<h3>タイトル</h3>
								<input type="text" name="title" value="" required>
							</div>

							<div>
								<h3>クライアント名</h3>
								<input type="text" name="client" value="" required>
							</div>

							<div>
								<h3>内容</h3>
								<textarea name="content" rows="5" cols="5" required></textarea>
							</div>

							<div>
								<input type="hidden" name="date" v-bind:value="$parent.addNowDatetime()" required>
								<input type="hidden" name="category" value="monthly">
								<input type="submit" name="submit" value="送信">
							</div>
						</form>
					</div>

					<label class="toggle-button" for="modal">Close &times;</label>
				</div>
			</div>
		</header>

		<div v-for="task in $parent.tasks" v-if="task.category === 'monthly'">
			<h3>{{ task.title }} | {{ task.category }}</h3>
			<p><span><i class="fa fa-address-book-o"></i> {{ task.client }}</span><span><i class="fa fa-clock-o"></i> {{ task.date }}</span></p>
			<div>{{ task.content }}</div>
			<aside>
				<ul>
					<li><a href="#"><i class="fa fa-pencil"></i> 編集</a></li>
					<li><a href="#" v-on:click="$parent.deleteTask(task.id)"><i class="fa fa-eraser"></i> 削除</a></li>
				</ul>
			</aside>
		</div>
	</section>
</script>

<script>
Vue.component('taskboard', {
	template: '#template-tasks',
	data: function(){
		return {
			modalEnabled: false
		}
	},
	methods: {
		addTask: function(event){
			vm.addTask(event);
			this.modalEnabled = false;
		}
	}
})
Vue.component('receiptboard', {
	template: '#template-receipts'
})
Vue.component('monthlyboard', {
	template: '#template-monthly',
	data: function(){
		return {
			modalEnabled: false
		}
	},
	methods: {
		addTask: function(event){
			vm.addTask(event);
			this.modalEnabled = false;
		}
	}
})



var vm = new Vue({
	el: '#wrap',
	data: {
		showTemplate: 'taskboard',

		tasks: [],
		title: '',
		client: '',
		date: '',
		content: '',
		category: '',

		name: 'みかん',
		price: 100
	},
	methods: {
		selectTemplate: function(target) {
			this.showTemplate = target;
		},
		focusOn: function(targetId){
			var element = document.getElementById(targetId);
			element.title.focus();
		},
		addNowDatetime: function(){
			return new Date().toLocaleString();
		},
		addTask: function(event){
			var newTasks = {
				id: Date.now(),
				title: event.target.title.value,
				client: event.target.client.value,
				date: event.target.date.value,
				content: event.target.content.value,
				category: event.target.category.value
			}
			this.tasks.push(newTasks);
			this.saveToStorage();
		},
		editTask: function(targetId){
//			var deletedTask = this.tasks.filter(function(task){
//				if(task.id !== targetId) return true;
//			});
//			this.tasks = deletedTask;
//			this.saveToStorage();
		},
		changeTask: function(targetId, changeTarget){
			var changedTask = this.tasks.map(function(task){
				if(task.id === targetId){
					task.category = changeTarget;
				}
				return task;
			});
			this.tasks = changedTask;
			this.saveToStorage();
		},
		deleteTask: function(targetId){
			var deletedTask = this.tasks.filter(function(task){
				if(task.id !== targetId) return true;
			});
			this.tasks = deletedTask;
			this.saveToStorage();
		},
		saveToStorage: function(){
			localStorage.setItem('tasks', JSON.stringify(this.tasks));
		}
	},
	mounted: function(){
		this.tasks = JSON.parse(localStorage.getItem('tasks'));
		if(!this.tasks) this.tasks = [];
	}
});
</script>
</body>
</html>
