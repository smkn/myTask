<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>myTask</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="format-detection" content="telephone=no, address=no, email=no">

<style>
html{overflow-y:scroll;box-sizing:border-box}body{line-height:1;-webkit-text-size-adjust:100%;word-break:break-all;word-wrap:break-word;text-justify:inter-ideograph;text-align:justify}article,aside,audio,canvas,details,figcaption,figure,footer,header,main,menu,nav,progress,section,video{display:block}html,body,address,article,aside,audio,blockquote,canvas,dd,details,div,dl,dt,figcaption,figure,footer,form,h1,h2,h3,h4,h5,h6,header,li,main,nav,ol,p,pre,section,table,ul,video{margin:0;padding:0;font-family:inherit;font-size:100%;font-style:normal;font-weight:normal;vertical-align:baseline;border:0;outline:0;background-color:transparent}a,caption,del,embed,iframe,img,label,legend,mark,object,ruby,small,span,sub,sup,svg,td,th,time,tr{margin:0;padding:0;font-family:inherit;font-size:100%;font-style:inherit;font-weight:inherit;vertical-align:baseline;border:0;outline:0;background-color:transparent}img,svg{vertical-align:bottom;font-size:0;line-height:0}button,input,textarea,select{margin:0;padding:0;font-family:inherit;font-size:100%;font-style:normal;font-weight:normal;vertical-align:middle;border-radius:0;border:1px solid #999;line-height:inherit}sup{vertical-align:text-top}sub{vertical-align:text-bottom}del{text-decoration:line-through}b,em,strong{font-weight:bold}table{border-collapse:collapse;border-spacing:0;width:100%;table-layout:fixed}caption,th{text-align:left}ol,ul{list-style:none}blockquote{quotes:none}blockquote::before,blockquote::after{content:'';content:none}:focus{outline:0}input::-moz-focus-inner{padding:0;border:0}*,*::before,*::after{box-sizing:inherit}

body {
	background-color: #f3f3f3;
	color: #222;
	font: 14px/1.6 Ubuntu, Verdana, "メイリオ", Meiryo, "ヒラギノ角ゴシック Pro", "Hiragino Kaku Gothic Pro", "ヒラギノ角ゴ ProN W3", sans-serif;
	text-justify: inter-ideograph;
	text-align: justify;
}
a{color:#38b5cb}
#wrap {
	position: relative;
}
nav{
	width: 200px;
	height: 100vh;
	position: fixed;
	padding: 10px 0;
	background-color: #474747;
	color: #f9f9f9;
	line-height: 1;
	font-family: 'Belleza', sans-serif;
}
@media screen and (max-width: 767px) {
	nav{
		width: 100vw;
		height: auto;
		position: relative;
		text-align: center;
	}
	nav li{
		display: inline-block;
	}
}
nav h1{
	text-align: center;
	font-size: 54px;
	text-shadow: 1px 1px 1px #292929, 0px 0px 10px #a9a9a9;
	margin-bottom: 20px;
}
nav a{
	color: #f9f9f9;
	text-decoration: none;
	padding: 10px 20px;
	display: block;
	font-size: 18px;
	letter-spacing: 2px;
	text-shadow: 1px 1px 1px #101010;
}
@media screen and (max-width: 767px) {
	nav a{
		padding: 10px;
	}
}
#nav-tasks:hover, .router-link-exact-active #nav-tasks, .current #nav-tasks{
	border-right: 5px solid #17b4d5;
}
#nav-receipts:hover, .router-link-exact-active #nav-receipts, .current #nav-receipts{
	border-right: 5px solid #09cd49;
}
#nav-monthly:hover, .router-link-exact-active #nav-monthly, .current #nav-monthly{
	border-right: 5px solid #b4d517;
}
#nav-backup:hover{
	border-right: 5px solid #d65718;
}
@media screen and (max-width: 767px) {
	#nav-tasks:hover, .router-link-exact-active #nav-tasks, .current #nav-tasks{
		border-right: none;
		border-bottom: 5px solid #17b4d5;
		padding-bottom: 5px;
	}
	#nav-receipts:hover, .router-link-exact-active #nav-receipts, .current #nav-receipts{
		border-right: none;
		border-bottom: 5px solid #09cd49;
		padding-bottom: 5px;
	}
	#nav-monthly:hover, .router-link-exact-active #nav-monthly, .current #nav-monthly{
		border-right: none;
		border-bottom: 5px solid #b4d517;
		padding-bottom: 5px;
	}
}
article{
	width: calc(100vw - 220px);
	position: relative;
	left: 200px;
	top: 0;
	padding: 20px;
}
@media screen and (max-width: 767px) {
	article{
		width: 100vw;
		left: 0;
		top: 0;
	}
}
article header h2{
	font-size: 36px;
	letter-spacing: 2px;
	font-family: 'Belleza', sans-serif;
	padding-bottom: 5px;
	line-height: 1;
}
#section-tasks h2{
	border-bottom: 2px solid #17b4d5;
}
#section-receipts h2{
	border-bottom: 2px solid #09cd49;
}
#section-monthly h2{
	border-bottom: 2px solid #b4d517;
}
article header{
	margin-bottom: 10px;
}
article header ul{
	font-size: 0;
	text-align: right;
	margin-top: 5px;
}
article header li{
	display: inline-block;
}
article header li label{
	font-size: 12px;
	display: block;
	margin-left: 5px;
	color: #fff;
	padding: 5px 20px;
	border-radius: 6px;
	text-decoration: none;
	cursor: pointer;
}
article header li label:hover{
	color: #fff;
	opacity: .7;
}
#section-tasks header li label{
	background-color: #17b4d5;
}
#section-receipts header li label{
	background-color: #09cd49;
}
#section-monthly header li label{
	background-color: #b4d517;
}

article section{
	margin-bottom: 20px;
}
article section > div{
	border: 1px solid #dbdbdb;
	background-color: #fff;
	padding: 20px;
	margin-bottom: 10px;
	border-radius: 6px;
	white-space: pre-line;
}
article section > div h3{
	font-size: 20px;
	margin-bottom: 5px;
	padding-left: 10px;
	line-height: 1.2;
}
#section-tasks > div h3{
	border-left: 5px solid #17b4d5;
}
#section-receipts > div h3{
	border-left: 5px solid #09cd49;
}
#section-monthly > div h3{
	border-left: 5px solid #b4d517;
}
article section > div > p{
	font-size: 12px;
	color: #818181;
	margin-bottom: 15px;
}
article section > div > p span{
	margin-right: 10px;
}

section aside{
	margin-top: 10px;
}
section aside ul{
	font-size: 0;
	text-align: right;
	margin-top: 5px;
}
section aside li{
	display: inline-block;
}
section aside li a, section aside li label{
	font-size: 12px;
	display: block;
	margin: 0 0 5px 5px;
	color: #fff;
	padding: 5px 20px;
	border-radius: 6px;
	text-decoration: none;
	cursor: pointer;
}
section aside li a:hover, section aside li label:hover{
	color: #fff;
	opacity: .7;
}
#section-tasks aside li a, #section-tasks aside li label{
	background-color: #17b4d5;
}
#section-receipts aside li a, #section-receipts aside li label{
	background-color: #09cd49;
}
#section-monthly aside li a, #section-monthly aside li label{
	background-color: #b4d517;
}

footer{
	text-align: center;
}



/* form */
.form-wrap {
	width: 100%;
	display: block;
}
.form-wrap > div{
	margin-bottom: 20px;
}
.form-wrap input[type="text"], .form-wrap input[type="date"], .form-wrap input[type="select"], .form-wrap textarea {
	width: 100%;
	display: block;
	padding: 5px 10px;
	border: 1px solid #dbdbdb;
	border-radius: 6px;
}
.form-wrap input[type="submit"]{
	padding: 5px 20px;
	cursor: pointer;
}
.form-wrap > div{
	margin-bottom: 20px;
}



/* modal */
.modal-wrap input[type='checkbox'] {
	-webkit-appearance: none;
	-moz-appearance: none;
	appearance: none;
	display: none;
}

.modal-wrap .toggle-on:checked {
	position: fixed;
	overflow-y: auto;
	display: block;
	background-color: rgba(0, 0, 0, .5);
	width: 100vw;
	height: 100vh;
	z-index: 999;
	top: 0;
	left: 0;
}
.modal-wrap .modal-window {
	display: none;
	position: fixed;
	top: 0;
	left: 10vw;
	overflow-y: auto;
	width: 80vw;
	max-height: 90vh;
	background-color: #fff;
	margin: 5vh auto;
	padding: 20px;
	z-index: 9999;
}
.modal-wrap .toggle-on:checked + .modal-window {
	display: block;
}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:400,700|Belleza">

<script src="https://cdnjs.cloudflare.com/ajax/libs/vue/2.5.13/vue.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.23.0/moment.min.js"></script>
</head>
<body>
<div id="wrap">

	<nav>
		<h1>myTask</h1>
		<ul>
			<li v-bind:class="{current: showTemplate === 'taskboard'}"><a href="#" id="nav-tasks" v-on:click.prevent="selectTemplate('taskboard')"><i class="fa fa-pencil-square-o"></i> Tasks</a></li>
			<li v-bind:class="{current: showTemplate === 'receiptboard'}"><a href="#" id="nav-receipts" v-on:click.prevent="selectTemplate('receiptboard')"><i class="fa fa-trophy"></i> Receipts</a></li>
			<li v-bind:class="{current: showTemplate === 'monthlyboard'}"><a href="#" id="nav-monthly" v-on:click.prevent="selectTemplate('monthlyboard')"><i class="fa fa-calendar-check-o"></i> Monthly</a></li>
		</ul>
		<p><a id="nav-backup" v-on:click="backUpStorage"><i class="fa fa-cloud-download"></i> Backup</a></p>
	</nav>

	<article>
		<taskboard v-if="showTemplate === 'taskboard'"></taskboard>
		<receiptboard v-if="showTemplate === 'receiptboard'"></receiptboard>
		<monthlyboard v-if="showTemplate === 'monthlyboard'"></monthlyboard>

		<footer>Copyright &copy; 2016- <a href="http://www.kiki-verb.com/" target="_blank">kiki-verb.com</a>. All Rights Reserved.</footer>
	</article>

</div>



<script id="template-tasks" type="text/x-template">
	<section id="section-tasks">
		<header>
			<h2><i class="fa fa-pencil-square-o"></i> Tasks</h2>
			<ul>
				<li><label for="modal" v-on:click="$parent.addTaskSet('formtasks')"><i class="fa fa-plus-square"></i> 追加</label></li>
			</ul>

			<div class="modal-wrap" id="modal-tasks">
				<input type="checkbox" class="toggle-on" id="modal" v-model="modalEnabled" v-on:click="$parent.focusOnForm('formtasks')">
				<div class="modal-window">
					<div>
						<form action="" method="post" id="formtasks" class="form-wrap" v-on:submit.prevent="createTask">
							<div>
								<h3>タイトル</h3>
								<input type="text" name="title" value="" required>
							</div>

							<div>
								<h3>クライアント名</h3>
								<input type="text" name="client" value="" required>
							</div>

							<div>
								<h3>内容</h3>
								<textarea name="content" rows="5" cols="5" required></textarea>
							</div>

							<div>
								<input type="hidden" name="id" value="monthly">
								<input type="hidden" name="date" v-bind:value="$parent.addNowDatetime()">
								<input type="hidden" name="category" value="tasks">
								<input type="hidden" name="type" value="add">
								<input type="submit" name="submit" value="送信">
							</div>
						</form>
					</div>
				</div>
			</div>
		</header>

		<div v-for="task in $parent.tasks" v-if="task.category === 'tasks'">
			<h3>{{ task.title }}</h3>
			<p><span><i class="fa fa-address-book-o"></i> {{ task.client }}</span><span><i class="fa fa-clock-o"></i> {{ task.date }}</span></p>
			<div>{{ task.content }}</div>
			<aside>
				<ul>
					<li><label for="modal" v-on:click="$parent.editTaskSet(task.id, 'formtasks')"><i class="fa fa-pencil"></i> 編集</label></li>
					<li><a href="#" v-on:click="$parent.changeTask(task.id, 'receipts')"><i class="fa fa-check-square-o"></i> 完了</a></li>
					<li><a href="#" v-on:click="$parent.deleteTask(task.id)"><i class="fa fa-eraser"></i> 削除</a></li>
				</ul>
			</aside>
		</div>

	</section>
</script>

<script id="template-receipts" type="text/x-template">
	<section id="section-receipts">
		<header>
			<h2><i class="fa fa-trophy"></i> Receipts</h2>
		</header>

		<div v-for="task in $parent.tasks" v-if="task.category === 'receipts'">
			<h3>{{ task.title }}</h3>
			<p><span><i class="fa fa-address-book-o"></i> {{ task.client }}</span><span><i class="fa fa-clock-o"></i> {{ task.date }}</span></p>
			<div>{{ task.content }}</div>
			<aside>
				<ul>
					<li><a href="#" v-on:click="$parent.changeTask(task.id, 'tasks')"><i class="fa fa-share"></i> タスクに戻す</a></li>
<!--					<li><a href="#"><i class="fa fa-check-square-o"></i> 過去ログ化</a></li>-->
					<li><a href="#" v-on:click="$parent.deleteTask(task.id)"><i class="fa fa-eraser"></i> 削除</a></li>
				</ul>
			</aside>
		</div>
	</section>
</script>

<script id="template-monthly" type="text/x-template">
	<section id="section-monthly">
		<header>
			<h2><i class="fa fa-calendar-check-o"></i> Monthly</h2>
			<ul>
				<li><label for="modal" v-on:click="$parent.addTaskSet('formmonthly')"><i class="fa fa-plus-square"></i> 追加</label></li>
			</ul>

			<div class="modal-wrap" id="modal-monthly">
				<input type="checkbox" class="toggle-on" id="modal" v-model="modalEnabled" v-on:click="$parent.focusOnForm('formmonthly')">
				<div class="modal-window">
					<div>
						<form action="" method="post" id="formmonthly" class="form-wrap" v-on:submit.prevent="createTask">
							<div>
								<h3>タイトル</h3>
								<input type="text" name="title" value="" required>
							</div>

							<div>
								<h3>クライアント名</h3>
								<input type="text" name="client" value="" required>
							</div>

							<div>
								<h3>内容</h3>
								<textarea name="content" rows="5" cols="5" required></textarea>
							</div>

							<div>
								<input type="hidden" name="id" value="monthly">
								<input type="hidden" name="date" v-bind:value="$parent.addNowDatetime()">
								<input type="hidden" name="category" value="monthly">
								<input type="hidden" name="type" value="add">
								<input type="submit" name="submit" value="送信">
							</div>
						</form>
					</div>
				</div>
			</div>
		</header>

		<div v-for="task in $parent.tasks" v-if="task.category === 'monthly'">
			<h3>{{ task.title }}</h3>
			<p><span><i class="fa fa-address-book-o"></i> {{ task.client }}</span><span><i class="fa fa-clock-o"></i> {{ task.date }}</span></p>
			<div>{{ task.content }}</div>
			<aside>
				<ul>
					<li><label for="modal" v-on:click="$parent.editTaskSet(task.id, 'formmonthly')"><i class="fa fa-pencil"></i> 編集</label></li>
					<li><a href="#" v-on:click="$parent.deleteTask(task.id)"><i class="fa fa-eraser"></i> 削除</a></li>
				</ul>
			</aside>
		</div>
	</section>
</script>

<script>
Vue.component('taskboard', {
	template: '#template-tasks',
	data: function(){
		return {
			modalEnabled: false
		}
	},
	methods: {
		createTask: function(event){
			vm.createTask(event);
			this.modalEnabled = false;
		}
	}
})
Vue.component('receiptboard', {
	template: '#template-receipts'
})
Vue.component('monthlyboard', {
	template: '#template-monthly',
	data: function(){
		return {
			modalEnabled: false
		}
	},
	methods: {
		createTask: function(event){
			vm.createTask(event);
			this.modalEnabled = false;
		}
	}
})



var vm = new Vue({
	el: '#wrap',
	data: {
		showTemplate: 'taskboard',

		tasks: [],
		title: '',
		client: '',
		date: '',
		content: '',
		category: '',

		name: 'みかん',
		price: 100
	},
	methods: {
		selectTemplate: function(target) {
			this.showTemplate = target;
		},
		focusOnForm: function(targetFormId){
			var element = document.getElementById(targetFormId);
			element.title.focus();
		},
		addNowDatetime: function(){
			return new Date().toLocaleString();
		},
		createTask: function(event){
			if(event.target.type.value === 'add'){
				var newTask = {
					id: Date.now(),
					title: event.target.title.value,
					client: event.target.client.value,
					date: event.target.date.value,
					content: event.target.content.value,
					category: event.target.category.value
				}
				this.tasks.unshift(newTask);
			} else if(event.target.type.value === 'edit') {
				var newTasks = this.tasks.map(function(task){
					if(task.id == event.target.id.value){
						var newTask = {
							id: event.target.id.value,
							title: event.target.title.value,
							client: event.target.client.value,
							date: event.target.date.value,
							content: event.target.content.value,
							category: event.target.category.value
						}
						return newTask;
					} else {
						return task;
					}
				});
				this.tasks = newTasks;
			}
			this.saveToStorage();
		},
		addTaskSet: function(targetFormId){
			var element = document.getElementById(targetFormId);
			element.id.value = '';
			element.title.value = '';
			element.client.value = '';
			element.content.value = '';
			element.type.value = 'add';
		},
		editTaskSet: function(targetId, targetFormId){
			var element = document.getElementById(targetFormId);
			var targetTask = this.tasks.map(function(task){
				if(task.id === targetId){
					element.id.value = task.id;
					element.title.value = task.title;
					element.client.value = task.client;
					element.date.value = task.date;
					element.content.value = task.content;
					element.category.value = task.category;
					element.type.value = 'edit';
				}
			});
		},
		changeTask: function(targetId, changeTarget){
			var changedTask = this.tasks.map(function(task){
				if(task.id === targetId){
					task.category = changeTarget;
				}
				return task;
			});
			this.tasks = changedTask;
			this.saveToStorage();
		},
		deleteTask: function(targetId){
			var deletedTask = this.tasks.filter(function(task){
				if(task.id !== targetId) return true;
			});
			if(window.confirm('消すで？')){
				this.tasks = deletedTask;
				this.saveToStorage();
			}
		},
		saveToStorage: function(){
			localStorage.setItem('tasks', JSON.stringify(this.tasks));
		},
		backUpStorage: function() {
			var thisStorage = localStorage.getItem('tasks');
			var blob = new Blob([thisStorage], {type: "text/plain"});
			if(window.navigator.msSaveBlob){
				// IEなら独自関数を使います。
				window.navigator.msSaveBlob(blob, "ファイル名.txt");
			} else {
				// それ以外はaタグを利用してイベントを発火させます
				var a = document.getElementById('nav-backup');
				a.href = URL.createObjectURL(blob);
				a.target = '_blank';
				a.download = 'backUpStorage_'+moment().format('YYMMDD')+'.txt';
			}
		}
	},
	mounted: function(){
		this.tasks = JSON.parse(localStorage.getItem('tasks'));
		if(!this.tasks) this.tasks = [];
	}
});
</script>
</body>
</html>
